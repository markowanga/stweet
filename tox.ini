[tox]
envlist = pep8,docstyle,tests&cov
skipsdist = True

[testenv:pep8]
deps =
    flake8
basepython = python3
commands =
    flake8 {posargs}

[testenv:docstyle]
deps =
    pydocstyle
basepython = python3
commands =
    pydocstyle --verbose {posargs}

[testenv:tests&cov]
deps =
    pytest
    pytest-cov
    -rrequirements.txt
basepython = python3
setenv =
    PYTHONPATH={toxinidir}/
    COV_CORE_CONFIG={toxinidir}/.coveragerc
commands =
    docker-compose -f {toxinidir}/test-services-docker-compose.yml up -d
    pytest -s tests --cov-fail-under=100 --cov-report=xml --cov-report=term --cov=stweet
    docker-compose -f {toxinidir}/test-services-docker-compose.yml stop
    docker-compose -f {toxinidir}/test-services-docker-compose.yml rm -f

[flake8]
# W503 - is said to be incompatible with current PEP8, however flake8 is
#   not updated to handle it
# W504 skipped because it is overeager and unnecessary
ignore = W503,W504
per-file-ignores = __init__.py:F401
show-source = True
exclude = .git,.venv,.tox,dist,doc,*egg,build,venv,tests,tmp
import-order-style = pep8
max-line-length = 120


[pydocstyle]
# D104 Missing docstring in public package
# D203 1 blank line required before class docstring
# D213 Multi-line docstring summary should start at the second line
# D214 Section is over-indented
# D215 Section underline is over-indented
# D401 First line should be in imperative mood; try rephrasing
# D405 Section name should be properly capitalized
# D406 Section name should end with a newline
# D407 Missing dashed underline after section
# D408 Section underline should be in the line following the sectionâ€™s name
# D409 Section underline should match the length of its name
# D410 Missing blank line after section
# D411 Missing blank line before section
ignore = D104,D203,D213,D214,D215,D401,D405,D406,D407,D408,D409,D410,D411
match-dir = ^(?!\.tox|venv|tests|tmp).*
match = ^(?!setup).*\.py
